# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ NTC Sphere
üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ MikroTik

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Ubuntu

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker –∏ Docker Compose

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

–ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     –í–Ω–µ—à–Ω—è—è —Å–µ—Ç—å (WAN)                          ‚îÇ
‚îÇ                         86.62.91.34                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ   MikroTik    ‚îÇ
                 ‚îÇ  –†–æ—É—Ç–µ—Ä/–§–∞–µ—Ä–≤–æ–ª ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ  –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å  ‚îÇ
                ‚îÇ  192.168.200.0/24 ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ –°–µ—Ä–≤–µ—Ä Ubuntu       ‚îÇ
                 ‚îÇ 192.168.200.220     ‚îÇ
                 ‚îÇ Docker + Caddy      ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:
–°–µ—Ä–≤–µ—Ä Ubuntu 20.04+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 22.04 LTS)

MikroTik —Ä–æ—É—Ç–µ—Ä —Å –≤–Ω–µ—à–Ω–∏–º IP

–ú–∏–Ω–∏–º—É–º 4GB RAM, 50GB HDD

–°–æ—Ñ—Ç:
Docker –∏ Docker Compose

SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

–î–æ—Å—Ç—É–ø –∫ MikroTik WebFig –∏–ª–∏ WinBox

üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MikroTik
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ IP –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
bash
# –í MikroTik:
/ip dhcp-server lease
add address=192.168.200.220 mac-address=XX:XX:XX:XX:XX:XX server=dhcp1
comment="NTC Sphere Server" disabled=no
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT (–ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤)
bash
# –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 80 (HTTP)
/ip firewall nat add chain=dstnat dst-address=86.62.91.34 protocol=tcp dst-port=80 \
  action=dst-nat to-addresses=192.168.200.220 to-ports=80

# –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 443 (HTTPS)
/ip firewall nat add chain=dstnat dst-address=86.62.91.34 protocol=tcp dst-port=443 \
  action=dst-nat to-addresses=192.168.200.220 to-ports=443
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª —Ñ–∞–µ—Ä–≤–æ–ª–∞
bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø–æ—Ä—Ç—ã 80/443
/ip firewall filter add chain=input protocol=tcp dst-port=80,443 action=accept \
  comment="Allow HTTP/HTTPS from WAN"

# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
/ip firewall filter add chain=forward dst-address=192.168.200.220 protocol=tcp \
  dst-port=80,443 action=accept comment="Forward to NTC Sphere Server"

# –í–∞–∂–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ü–û–°–õ–ï reject –ø—Ä–∞–≤–∏–ª!
# –ù–∞–π–¥–∏—Ç–µ –Ω–æ–º–µ—Ä reject –ø—Ä–∞–≤–∏–ª–∞:
/ip firewall filter print where action=reject

# –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–¥ reject:
/ip firewall filter move [find comment="Forward to NTC Sphere Server"] 0
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ NAT –ø—Ä–∞–≤–∏–ª–∞
/ip firewall nat print

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
/ip firewall filter print

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
/ip firewall connection print where dst-port=80 or dst-port=443
üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
1. –°–æ–∑–¥–∞–Ω–∏–µ A –∑–∞–ø–∏—Å–µ–π —É DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
text
n8n.ntcsphere.com    A    86.62.91.34    TTL: 3600
webui.ntcsphere.com  A    86.62.91.34    TTL: 3600
pgadmin.ntcsphere.com A    86.62.91.34    TTL: 3600
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π
bash
# –ò–∑ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏
nslookup n8n.ntcsphere.com 8.8.8.8

# –ò–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏
nslookup n8n.ntcsphere.com
üñ•Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Ubuntu
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl git ufw htop
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
bash
sudo timedatectl set-timezone Europe/Moscow
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
bash
# –°–º–µ–Ω–∞ –ø–æ—Ä—Ç–∞ SSH
sudo nano /etc/ssh/sshd_config
# Port 2222
# PermitRootLogin no
# PasswordAuthentication no

sudo systemctl restart sshd
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall (UFW)
bash
# –û—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
sudo ufw status verbose
üê≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker –∏ Docker Compose
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
bash
# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏
sudo apt remove docker docker-engine docker.io containerd runc

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release

# –î–æ–±–∞–≤–ª—è–µ–º GPG –∫–ª—é—á Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo docker --version
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker –±–µ–∑ sudo
bash
sudo groupadd docker
sudo usermod -aG docker $USER
newgrp docker

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
docker run hello-world
3. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
bash
mkdir -p ~/ntcsphere/{caddy/{data,config},postgres/{data,init},redis/data,open-webui/data,n8n/data,docling/data,pgadmin/data,ollama/models}
cd ~/ntcsphere
4. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
bash
nano .env
env
# PostgreSQL —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
POSTGRES_SUPERUSER=ntcsphere_admin
POSTGRES_SUPERPASS=Strong_Password_123!

# OpenAI API –∫–ª—é—á (–¥–ª—è n8n –∏ Open WebUI)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# PgAdmin —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
PGADMIN_EMAIL=admin@ntcsphere.com
PGADMIN_PASSWORD=PgAdmin_Strong_Pass_123!

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TZ=Europe/Moscow
‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
1. –°–æ–∑–¥–∞–Ω–∏–µ Caddyfile
bash
nano Caddyfile
caddy
{
    email ai.system@ntcsphere.com
    admin off
}

# Open WebUI
webui.ntcsphere.com {
    reverse_proxy open-webui:8080
}

# n8n
n8n.ntcsphere.com {
    reverse_proxy n8n:5678
}

# pgAdmin –Ω–∞ –ø–æ—Ä—Ç—É 5050
pgadmin.ntcsphere.com {
    reverse_proxy pgadmin:5050
}
2. –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.yaml
bash
nano docker-compose.yaml
yaml
version: '3.8'

networks:
  webnet:
    driver: bridge

services:
  caddy:
    image: caddy:2.8
    container_name: caddy
    restart: unless-stopped
    ports:
      - "443:443"
      - "80:80"
      - "443:443/udp"  # –î–ª—è HTTP/3
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ./caddy/data:/data
      - ./caddy/config:/config
    networks: [webnet]
    extra_hosts:
      - "host.docker.internal:host-gateway"

  postgres:
    image: postgres:16
    container_name: postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_SUPERUSER}
      POSTGRES_PASSWORD: ${POSTGRES_SUPERPASS}
      POSTGRES_DB: postgres
      TZ: ${TZ}
    volumes:
      - ./postgres/data:/var/lib/postgresql/data
      - ./postgres/init:/docker-entrypoint-initdb.d
    networks: [webnet]
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_SUPERUSER}"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: redis
    restart: unless-stopped
    command: redis-server --appendonly yes
    volumes:
      - ./redis/data:/data
    networks: [webnet]
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    environment:
      OLLAMA_HOST: 0.0.0.0
      OLLAMA_KEEP_ALIVE: 24h
      OLLAMA_NUM_PARALLEL: 2
    volumes:
      - ./ollama/models:/root/.ollama
    networks: [webnet]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]  # –ï—Å–ª–∏ –µ—Å—Ç—å GPU

  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: open-webui
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://${POSTGRES_SUPERUSER}:${POSTGRES_SUPERPASS}@postgres:5432/openwebui
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OLLAMA_BASE_URL: http://ollama:11434
      WEBUI_AUTH: "true"
      ENABLE_SIGNUP: "true"
      REQUIRE_USER_LOGIN: "true"
      ALLOW_GUEST_USERS: "false"
      ALLOWED_EMAIL_DOMAINS: "ntcsphere.com"
      REQUIRE_EMAIL_DOMAIN: "true"
      REQUIRE_EMAIL_VERIFICATION: "false"
      EMAIL_VERIFICATION: "false"
      DISABLE_SIGNUP: "false"
      APP_TITLE: "NTC Sphere AI Assistant"
      APP_DESCRIPTION: "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç NTC Sphere"
      WEBUI_SECRET_KEY: "change-this-to-a-random-secret-key"
    volumes:
      - ./open-webui/data:/app/backend/data
    networks: [webnet]
    depends_on:
      postgres:
        condition: service_healthy
      ollama:
        condition: service_started

  n8n:
    image: n8nio/n8n:2.0.3
    container_name: n8n
    restart: unless-stopped
    environment:
      DB_TYPE: postgresdb
      DB_POSTGRESDB_HOST: postgres
      DB_POSTGRESDB_DATABASE: n8n
      DB_POSTGRESDB_USER: ${POSTGRES_SUPERUSER}
      DB_POSTGRESDB_PASSWORD: ${POSTGRES_SUPERPASS}
      N8N_HOST: n8n.ntcsphere.com
      N8N_PROTOCOL: https
      N8N_PORT: 5678
      N8N_EDITOR_BASE_URL: https://n8n.ntcsphere.com
      WEBHOOK_URL: https://n8n.ntcsphere.com
      N8N_ENDPOINT_WEBHOOK: webhook
      N8N_PROXY_HOPS: 1
      EXPRESS_TRUST_PROXY: true
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      N8N_METRICS: "false"
      N8N_ENABLE_PRODUCTION_WEBHOOKS_ON_MAIN_PROCESS: "false"
      NODE_ENV: production
      WEBHOOK_TUNNEL_URL: https://n8n.ntcsphere.com/
    volumes:
      - ./n8n/data:/home/node/.n8n
    networks: [webnet]
    depends_on:
      postgres:
        condition: service_healthy

  docling:
    image: ghcr.io/docling-project/docling-serve:latest
    container_name: docling
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://${POSTGRES_SUPERUSER}:${POSTGRES_SUPERPASS}@postgres:5432/docling
    volumes:
      - ./docling/data:/data
    networks: [webnet]
    depends_on:
      postgres:
        condition: service_healthy

  pgadmin:
    image: dpage/pgadmin4:8
    container_name: pgadmin
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
      PGADMIN_LISTEN_PORT: 5050
      PGADMIN_CONFIG_SERVER_MODE: "False"
      PGADMIN_CONFIG_MASTER_PASSWORD_REQUIRED: "False"
    volumes:
      - ./pgadmin/data:/var/lib/pgadmin
      - ./pgadmin/servers.json:/pgadmin4/servers.json  # –î–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    networks: [webnet]
    depends_on:
      - postgres
3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
bash
nano postgres/init/01-init-databases.sql
sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
CREATE DATABASE openwebui;
CREATE DATABASE n8n;
CREATE DATABASE docling;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CREATE USER ntcsphere_app WITH PASSWORD 'App_Password_123!';

-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
GRANT ALL PRIVILEGES ON DATABASE openwebui TO ntcsphere_app;
GRANT ALL PRIVILEGES ON DATABASE n8n TO ntcsphere_app;
GRANT ALL PRIVILEGES ON DATABASE docling TO ntcsphere_app;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
\c openwebui
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

\c n8n
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

\c docling
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ pgAdmin
bash
nano pgadmin/servers.json
json
{
    "Servers": {
        "1": {
            "Name": "NTC Sphere PostgreSQL",
            "Group": "Servers",
            "Host": "postgres",
            "Port": 5432,
            "MaintenanceDB": "postgres",
            "Username": "${POSTGRES_SUPERUSER}",
            "PassFile": "/pgpass",
            "SSLMode": "prefer",
            "Timeout": 10,
            "UseSSHTunnel": 0,
            "TunnelPort": "22",
            "TunnelAuthentication": 0
        }
    }
}
bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–∞—Ä–æ–ª–µ–º
echo "postgres:5432:*:${POSTGRES_SUPERUSER}:${POSTGRES_SUPERPASS}" > pgadmin/pgpass
chmod 600 pgadmin/pgpass
üöÄ –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose config

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps
docker-compose logs --tail=50
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Caddy
curl -I https://n8n.ntcsphere.com
curl -I https://webui.ntcsphere.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker exec -it postgres psql -U ${POSTGRES_SUPERUSER} -c "\l"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker-compose exec postgres pg_isready -U ${POSTGRES_SUPERUSER}
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–µ–π Ollama
bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π
docker exec -it ollama ollama pull llama2
docker exec -it ollama ollama pull mistral

# –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
docker exec -it ollama ollama list
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Open WebUI
–û—Ç–∫—Ä–æ–π—Ç–µ https://webui.ntcsphere.com

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å email @ntcsphere.com

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Ollama –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

–î–æ–±–∞–≤—å—Ç–µ OpenAI API –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GPT –º–æ–¥–µ–ª—è–º

5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n
–û—Ç–∫—Ä–æ–π—Ç–µ https://n8n.ntcsphere.com

–ó–∞–≤–µ—Ä—à–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ n8n

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤–µ–±—Ö—É–∫–æ–≤

üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
nslookup n8n.ntcsphere.com 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ —Å–Ω–∞—Ä—É–∂–∏
telnet 86.62.91.34 443
nc -zv 86.62.91.34 443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ –∏–∑–Ω—É—Ç—Ä–∏
ss -tulpn | grep -E ':80|:443'
2. –õ–æ–≥–∏ Caddy
bash
docker logs caddy --tail 100 --follow

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
docker exec caddy caddy validate --config /etc/caddy/Caddyfile
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
bash
# –ò–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Caddy –∫ –±—ç–∫–µ–Ω–¥–∞–º
docker exec caddy curl -I http://open-webui:8080
docker exec caddy curl -I http://n8n:5678

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ Docker
docker network inspect ntcsphere_webnet
4. –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
docker exec caddy ls -la /data/caddy/certificates/

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
docker-compose restart caddy
5. –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–º–æ–≤ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
docker-compose down -v

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose build --no-cache
docker-compose up -d
üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
1. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose pull
docker-compose up -d

# –û—á–∏—Å—Ç–∫–∞ Docker
docker system prune -a --volumes
2. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
bash
#!/bin/bash
# backup.sh
BACKUP_DIR="/backup/ntcsphere"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR/$DATE

# –î–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec postgres pg_dumpall -U ${POSTGRES_SUPERUSER} > $BACKUP_DIR/$DATE/postgres.sql

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
cp -r ~/ntcsphere/* $BACKUP_DIR/$DATE/

# –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
tar -czf $BACKUP_DIR/ntcsphere_backup_$DATE.tar.gz -C $BACKUP_DIR/$DATE .

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $BACKUP_DIR/ntcsphere_backup_$DATE.tar.gz"
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cAdvisor –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker run \
  --volume=/:/rootfs:ro \
  --volume=/var/run:/var/run:ro \
  --volume=/sys:/sys:ro \
  --volume=/var/lib/docker/:/var/lib/docker:ro \
  --volume=/dev/disk/:/dev/disk:ro \
  --publish=8081:8080 \
  --detach=true \
  --name=cadvisor \
  --privileged \
  --device=/dev/kmsg \
  gcr.io/cadvisor/cadvisor:v0.47.0
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
git init
git add .
git commit -m "Initial configuration"

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull origin main
docker-compose down
docker-compose up -d --build
üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f --tail=50

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it postgres bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
du -sh ~/ntcsphere/*

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
sudo nethogs
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:
–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π

–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ - –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –º–æ–¥–µ–ª–µ–π Ollama

–ü–∞–º—è—Ç—å - Open WebUI –∏ n8n –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏

–ë—ç–∫–∞–ø—ã - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ NTC Sphere —Å:

‚úÖ Open WebUI - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ –æ–±–ª–∞—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
‚úÖ n8n - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚úÖ PostgreSQL - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ PgAdmin - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
‚úÖ Ollama - –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ LLM –º–æ–¥–µ–ª–µ–π
‚úÖ Redis - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
‚úÖ Caddy - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ SSL –∏ reverse proxy

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏, —Ç–∞–∫ –∏ –∏–∑–≤–Ω–µ —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞.

üîÑ –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ MikroTik (NAT + firewall)

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Ubuntu

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Caddyfile

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ docker-compose.yaml

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ LAN

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ WAN

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–µ–π Ollama

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Open WebUI

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-02-06
–í–µ—Ä—Å–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: 1.0
–°—Ç–∞—Ç—É—Å: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ